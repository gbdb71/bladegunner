<style>body {
    margin: 0;
    background: #343635;
    text-align: center;
  }</style><canvas></canvas><script>function randomInt(e,t){return Math.floor(Math.random()*(t+1-e)+e)}function randomDirection(){return[DIRECTION_UP,DIRECTION_RIGHT,DIRECTION_DOWN,DIRECTION_LEFT][randomInt(0,3)]}function distanceBetween(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function createEntity(e,t,i,n){var r=data[e].size;return t=void 0!==t?t:randomDirection(),i=void 0!==i?i:randomInt(0,WIDTH-r),n=void 0!==n?n:randomInt(0,HEIGHT-r),{action:"walk",direction:t,lastDirection:t?t:DIRECTION_RIGHT,frame:0,lastFrame:0,lastOrient:0,lastGlitch:0,lastBullet:0,type:e,variant:randomInt(0,data[e].sprites.length-1),size:r,x:i,y:n}}function createHero(){return createEntity("hero",0)}function createAndroid(){for(var e=createEntity("android");distanceBetween(e,hero)<1.5*GLITCH_TRIGGER_DISTANCE;)e.x=randomInt(0,WIDTH-e.size),e.y=randomInt(0,HEIGHT-e.size);return e}function createBullet(e){var t=createEntity("bullet",e.lastDirection,e.x,e.y);return t.action="trace",t.lastDirection&DIRECTION_LEFT&&(t.x-=t.size),t.lastDirection&DIRECTION_RIGHT&&(t.x+=e.size),t.lastDirection&DIRECTION_UP&&(t.y-=t.size),t.lastDirection&DIRECTION_DOWN&&(t.y+=e.size),t.lastDirection&DIRECTION_LEFT||t.lastDirection&DIRECTION_RIGHT||(t.x+=(e.size-t.size)/2),t.lastDirection&DIRECTION_UP||t.lastDirection&DIRECTION_DOWN||(t.y+=(e.size-t.size)/2),t}function orientEntity(e,t){if("hero"===e.type){var i=0;e.moveLeft&&!e.moveRight&&(i|=DIRECTION_LEFT),e.moveRight&&!e.moveLeft&&(i|=DIRECTION_RIGHT),e.moveUp&&!e.moveDown&&(i|=DIRECTION_UP),e.moveDown&&!e.moveUp&&(i|=DIRECTION_DOWN),e.lastDirection=i?i:e.lastDirection,e.direction=i}else DIRECTION_CHANGE_FREQ+Math.random()*DIRECTION_CHANGE_VAR<(e.lastOrient+=t)&&(e.lastOrient=0,e.direction=randomDirection(),e.lastDirection=e.direction)}function getSprites(e){return data[e.type].sprites[e.variant][e.action]}function frameEntity(e,t){(e.lastFrame+=t)>FRAME_INTERVAL[e.action]&&(e.lastFrame=0,e.frame=++e.frame%getSprites(e).length)}function glitchEntity(e,t){"android"===e.type&&(!e.glitch&&distanceBetween(e,hero)<GLITCH_TRIGGER_DISTANCE||GLITCH_CHANGE_FREQ+Math.random()*GLITCH_CHANGE_VAR<(e.lastGlitch+=t))&&(e.lastGlitch=0,e.glitch=!e.glitch,e.action=e.glitch?"shoot":"walk"),e.glitch&&(e.lastBullet+=t)>SHOOT_FREQ&&(e.lastBullet=0,e.createBullet=!0)}function moveEntity(e,t){var i=data[e.type].speed*t;e.direction&DIRECTION_RIGHT&&(e.x+=i),e.direction&DIRECTION_LEFT&&(e.x-=i),e.direction&DIRECTION_UP&&(e.y-=i),e.direction&DIRECTION_DOWN&&(e.y+=i)}function containEntity(e){e.x<=0?(e.x=0,e!==hero&&(e.direction=e.direction^DIRECTION_LEFT|DIRECTION_RIGHT,e.lastDirection=e.direction)):e.x+e.size>=WIDTH&&(e.x=WIDTH-e.size,e!==hero&&(e.direction=e.direction^DIRECTION_RIGHT|DIRECTION_LEFT,e.lastDirection=e.direction)),e.y<=data.bg.size?(e.y=data.bg.size,e!==hero&&(e.direction=e.direction^DIRECTION_UP|DIRECTION_DOWN,e.lastDirection=e.direction)):e.y>=HEIGHT-e.size&&(e.y=HEIGHT-e.size,e!==hero&&(e.direction=e.direction^DIRECTION_DOWN|DIRECTION_UP,e.lastDirection=e.direction))}function containBullet(e){return e.x<=0||e.x+e.size>=WIDTH||e.y<=data.bg.size||e.y>=HEIGHT-e.size}function collideEntity(e,t){for(var i in t){var n=t[i];if(e!==n&&e.x+COLLISION_TOLERANCE>=n.x&&e.x+e.size-COLLISION_TOLERANCE<=n.x+n.size&&e.y+COLLISION_TOLERANCE>=n.y&&e.y+e.size-COLLISION_TOLERANCE<=n.y+n.size)return i}}function updateScore(e){"bystander"===e.type&&nb_casualties++,"android"===e.type&&nb_retires++,"hero"===e.type&&(hero_dead=!0)}function checkEndGame(){hero_dead||nb_bystanders===nb_casualties?(win=!1,endGame()):nb_retires===nb_androids&&(win=!0,endGame())}function endGame(){win||(nb_androids=0),cancelAnimationFrame(requestId),requestId=void 0,removeEventListener("keydown",keyPressed),removeEventListener("keyup",keyReleased),addEventListener("keydown",newGame),addEventListener("resize",renderEndGame),renderEndGame()}function renderEndGame(){requestAnimationFrame(function(){ctx.fillStyle=GREY,ctx.fillRect(0,data.bg.size,WIDTH,HEIGHT-data.bg.size),ctx.fillStyle=WHITE;var e=hero_dead?"Oh no, you died!":nb_casualties===nb_bystanders?"Oh no, all civilians died!":"Cool, you disabled all glitchy androids!";ctx.fillText(e,(WIDTH-ctx.measureText(e).width)/2,HEIGHT/2),e="Press ENTER to play again",ctx.fillText(e,(WIDTH-ctx.measureText(e).width)/2,2*HEIGHT/3),blit()})}function renderEntity(e){var t=getSprites(e)["hero"===e.type&&0===e.direction?0:e.frame],i=e.lastDirection&DIRECTION_LEFT?data.flippedTileset:data.tileset;ctx.drawImage(i,Math.floor(t.x),Math.floor(t.y),e.size,e.size,Math.floor(e.x),Math.floor(e.y),e.size,e.size)}function renderScore(){ctx.fillStyle=GREY,ctx.fillRect(0,0,WIDTH,data.bg.size),ctx.fillStyle=RED,ctx.fillText(TITLE,0,0),ctx.fillStyle=WHITE,ctx.fillText("androids: "+nb_retires+"/"+nb_androids,WIDTH/3,0);var e="casulaties: "+nb_casualties;ctx.fillText(e,WIDTH-ctx.measureText(e).width,0)}function createBackground(){for(var e=data.bg.size,t=0;t<WIDTH;t+=e)for(var i=e;i<HEIGHT;i+=e){var n=data.bg.sprites[randomInt(1,10)>9?1:0];bg_ctx.drawImage(data.tileset,n.x,n.y,e,e,t,i,e,e)}}function resize(){var e=Math.min(window.innerWidth/WIDTH,window.innerHeight/HEIGHT);viewport.width=WIDTH*e,viewport.height=HEIGHT*e,viewport_ctx.mozImageSmoothingEnabled=!1,viewport_ctx.webkitImageSmoothingEnabled=!1,viewport_ctx.msImageSmoothingEnabled=!1,viewport_ctx.imageSmoothingEnabled=!1}function newGame(e){13==e.which&&startGame()}function keyPressed(e){32==e.which&&(hero.action="shoot",hero.createBullet=!0),37==e.which&&(hero.moveLeft=!0),38==e.which&&(hero.moveUp=!0),39==e.which&&(hero.moveRight=!0),40==e.which&&(hero.moveDown=!0)}function keyReleased(e){32==e.which&&(hero.action="walk"),37==e.which&&(hero.moveLeft=!1),38==e.which&&(hero.moveUp=!1),39==e.which&&(hero.moveRight=!1),40==e.which&&(hero.moveDown=!1)}function startGame(){removeEventListener("keydown",newGame),removeEventListener("resize",renderEndGame),createBackground(),nb_retires=0,nb_casualties=0,hero_dead=!1,entities=[],bullets=[],entities.push(hero=createHero());for(var e=++nb_androids;e>0;e--)entities.push(createAndroid());nb_bystanders=randomInt(MIN_BYSTANDERS,MAX_BYSTANDERS);for(var e=nb_bystanders;e>0;e--)entities.push(createEntity("bystander"));addEventListener("keydown",keyPressed),addEventListener("keyup",keyReleased),lastTime=Date.now(),requestId=requestAnimationFrame(loop)}function init(){document.title=TITLE,viewport=document.querySelector("canvas"),viewport_ctx=viewport.getContext("2d"),resize(),addEventListener("resize",resize),canvas=document.createElement("canvas"),canvas.width=WIDTH,canvas.height=HEIGHT,ctx=canvas.getContext("2d"),ctx.font=FONT,ctx.textBaseline="top",bg=document.createElement("canvas"),bg.width=WIDTH,bg.height=HEIGHT,bg_ctx=bg.getContext("2d");var e=new Image;e.addEventListener("load",function(){data.tileset=e,data.flippedTileset=flipTileset(data.tileset),startGame()}),e.src=data.tileset}function flipTileset(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;for(var i=t.getContext("2d"),n=e.width/4,r=1;r<=4;r++)i.setTransform(-1,0,0,1,r*n,0),i.drawImage(e,(r-1)*n,0,n,e.height,0,0,n,e.height);return i.setTransform(1,0,0,1,0,0),t}function loop(){currentTime=Date.now(),update((currentTime-lastTime)/1e3),render(),lastTime=currentTime,requestId&&(requestId=requestAnimationFrame(loop))}function update(e){entities.forEach(function(t){glitchEntity(t,e),orientEntity(t,e),moveEntity(t,e),frameEntity(t,e),containEntity(t),t.createBullet&&(t.createBullet=!1,bullets.push(createBullet(t)))}),bullets.forEach(function(t,i){frameEntity(t,e),moveEntity(t,e);var n,r;(containBullet(t)||(n=collideEntity(t,entities))||(r=collideEntity(t,bullets)))&&(void 0!==n?updateScore(entities.splice(n,1)[0]):void 0!==r&&bullets.splice(r,1),bullets.splice(i,1))}),checkEndGame()}function blit(){viewport_ctx.drawImage(canvas,0,0,WIDTH,HEIGHT,0,0,viewport.width,viewport.height)}function render(){ctx.drawImage(bg,0,0),entities.forEach(renderEntity),bullets.forEach(renderEntity),renderScore(),blit()}var bg,bg_ctx,canvas,ctx,viewport,viewport_ctx,currentTime,lastTime,elapsedTime,requestId,entities=[],bullets=[],nb_androids=0,nb_bystanders,nb_retires,nb_casualties,hero_dead,win,hero,data={tileset:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABlElEQVR42s2XwU3FMAyGMwoXhDgDbwsusAh3JE5swQQIsQQIsQErwJUJAk7rynF/JyWNHCxZSt3vuX/9EjcJYbb4EKL2oMyNScGPt5WPYgIHzw8XUY5bmRguF+bu+BoyFJd8Jujp6lBV7cYQwG5BnkwGvby+J6exfqs9jLxGDI+zRKRSQ7rMOhH/psRIbkue7M1okrJrQRYjBSHGqqLFJJNBBLTGWpkQv78i8lHMBNUamiMTuNmdPscFoHErU2qMzJiNUU4urZr/X08moFVDrie6F5NBEpRLci+jeYtxE8SNb5Mgnezo7DY56hdeTDK6gcZ/idWutzJTf/g8iciHMCkAmpXcWnoyC6R3gyjRFkY3RsToxggF/YsKLf9h4STgyUynAASKSZYxiqvm+XXuNzVmfUZSDzXPUWBlwPt8PTfGEoMFWaV2ZLruGrvsGO9vHmMPDw0GuzQlk1sB7S2C+BtlfhZmhjZ4K4YFoYe0COIHsVuiugmyqjesQhwrCeoyh3pWaJf1nkPdBPVcZbsFjepDyH4ASgFGlkfhZVYAAAAASUVORK5CYII=",bg:{size:9,sprites:[{x:0,y:27},{x:9,y:27}]},bullet:{speed:60,size:5,sprites:[{trace:[{x:20,y:27},{x:29,y:27}]}]},hero:{speed:30,size:9,sprites:[{walk:[{x:0,y:0},{x:9,y:0}],shoot:[{x:18,y:0},{x:27,y:0}]}]},bystander:{size:9,speed:20,sprites:[{walk:[{x:0,y:18},{x:9,y:18}]},{walk:[{x:0,y:9},{x:9,y:9}]}]},android:{size:9,speed:25,sprites:[{walk:[{x:0,y:9},{x:9,y:9}],shoot:[{x:18,y:9},{x:27,y:9}]},{walk:[{x:0,y:18},{x:9,y:18}],shoot:[{x:18,y:18},{x:27,y:18}]}]}};TITLE="BLADEGUNNER",FONT="8px Courier",GREY="#343635",WHITE="#fff1e8",RED="#ff004d",FRAME_INTERVAL={walk:.2,shoot:.1,trace:.1},DIRECTION_UP=1,DIRECTION_RIGHT=2,DIRECTION_DOWN=4,DIRECTION_LEFT=8,MAX_BYSTANDERS=50,MIN_BYSTANDERS=25,DIRECTION_CHANGE_FREQ=2,DIRECTION_CHANGE_VAR=1.5,GLITCH_CHANGE_FREQ=10,GLITCH_CHANGE_VAR=5,GLITCH_TRIGGER_DISTANCE=40,SHOOT_FREQ=.25,COLLISION_TOLERANCE=2,HEIGHT=153,WIDTH=198,addEventListener("load",init);</script>